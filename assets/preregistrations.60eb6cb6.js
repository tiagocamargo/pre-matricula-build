import{d as Ae,r as d,L as We,g as w,H as Me,o as a,z as j,C as W,c as r,a as e,s as c,A as _,p as s,w as Q,S as fe,t as n,N as Ge,a4 as ee,E as _e,Z as He,a2 as De,F as ne,y as ve,ae as Je,f as Pe,U as qe,u as je,v as Ye,B as re,a6 as Xe}from"./vendor.5ec4ebb3.js";import{u as ie,a as q,e as P,_ as S,c as Ve,q as Ke,b as Ze,o as Be,z as Qe,n as eo,m as oo,A as to,B as Ie,C as so,D as lo,E as Ne,F as ao,G as he,w as no,x as ro}from"./common.a40f3e2f.js";import{g as Ue,c as io,d as co,e as uo,f as mo,t as po,h as vo,i as ho,j as fo,k as _o,m as go,n as Eo,o as bo}from"./shared/prepregistrations-subscription/preregistrations.08008f18.js";const yo={key:0},xo={class:"m-auto",style:{"max-width":"740px"}},wo={key:0,class:"mt-4 text-danger font-weight-bold"},To=ee(" Tem certeza que deseja indeferir as pr\xE9-matr\xEDculas? "),Co=e("hr",null,null,-1),$o=[To,Co],ko={key:1,class:"mt-4 font-weight-bold"},So=ee(" Selecione a turma que deseja matricular os(as) alunos(as) para completar o deferimento das pr\xE9-matr\xEDculas dos(as) alunos(as). "),Ro=e("hr",null,null,-1),No={key:2,class:"mt-4 font-weight-bold"},Ao=ee(" Tem certeza que deseja convocar os respons\xE1veis desta(s) pr\xE9-matr\xEDcula(s)? "),Vo=e("hr",null,null,-1),Do=[Ao,Vo],Io={key:3,class:"form-group"},Oo=e("label",{class:"form-label"},"Observa\xE7\xF5es (opcional)",-1),Mo={key:4,class:"form-group"},Po=e("label",{class:"form-label"},"Justificativa (opcional)",-1),jo={key:5},Bo={class:"text-danger"},Uo=["innerHTML"],Lo={class:"d-flex justify-content-center mt-4"},zo={key:1},Fo={key:2},Wo={key:0,class:"mt-4 font-weight-bold"},Go={key:1,class:"mt-4 font-weight-bold"},Ho={key:2,class:"mt-4 font-weight-bold"},Jo={key:3,class:"mt-4"},qo={class:"text-danger"},Yo=["innerHTML"],Xo={class:"row justify-content-center d-flex mt-4"},Ko=Ae({__name:"PreRegistrationBatch",props:{filter:null,preregistrations:null,step:null,processYear:null,modelValue:{type:Boolean}},emits:["load"],setup(x,{emit:G}){const R=x,{loader:H}=ie(),{loader:Y}=ie(),{loader:z}=ie(),{loader:J,data:$}=q(),k=d(""),F=d(),A=d(!1),l=d(!1),V=d(),D=d(),y=d(!1),N=d(0),T=We(R,"modelValue"),C=w(()=>{switch(R.step){case"REJECT":return"Indeferimento em lote";case"ACCEPT":return"Deferimento em lote";case"SUMMON":return"Convoca\xE7\xE3o em lote";default:return""}});Me(()=>{T.value&&R.step==="ACCEPT"&&M()});const X=()=>{T.value=!1,k.value="",$.value=[],F.value=void 0,A.value=!1,l.value=!1,V.value=null,D.value=null,y.value=!1,N.value=0},B=()=>{X(),G("load")},f=()=>{if(!Number(F.value)){l.value=!0,V.value="\xC9 necess\xE1rio selecionar uma turma para realizar o Deferimento da pr\xE9-matr\xEDcula.",D.value="";return}y.value=!0,H(()=>io({ids:R.preregistrations.map(u=>Number(u)),classroom:Number(F.value)})).then(({acceptPreRegistrations:u})=>{u&&(A.value=!0,N.value=u.length)}).catch(u=>{u.response.data.errors&&u.response.data.errors.length?(l.value=!0,A.value=!0,V.value="N\xE3o foi poss\xEDvel realizar o deferimento de todos os(as) alunos(as)",D.value=u.response.data.errors.map(b=>{var E;return(E=b.extensions)==null?void 0:E.message}).join("<br>"),u.response.data.data.acceptPreRegistrations&&(N.value=u.response.data.data.acceptPreRegistrations.length)):u.errors&&u.errors.length&&(l.value=!0,V.value="N\xE3o foi poss\xEDvel realizar o deferimento de todos os(as) alunos(as)",D.value=u.errors.map(b=>{var E;return(E=b.extensions)==null?void 0:E.message}).join("<br>"))}).finally(()=>{y.value=!1})},O=()=>{y.value=!0,Y(()=>co({ids:R.preregistrations,justification:k.value})).then(({rejectPreRegistrations:u})=>{u&&(A.value=!0,N.value=u.length)}).catch(u=>{if(u.errors&&u.errors.length){l.value=!0,V.value=u.errors[0].message,D.value=u.errors.map(b=>{var E;return(E=b.extensions)==null?void 0:E.message}).join("<br>");return}}).finally(()=>{y.value=!1})},i=()=>{y.value=!0,z(()=>uo({ids:R.preregistrations,justification:k.value})).then(({summonPreRegistrations:u})=>{u&&(A.value=!0,N.value=u.length)}).catch(u=>{u.response.data.errors&&u.response.data.errors.length&&(l.value=!0,V.value="N\xE3o foi poss\xEDvel realizar a convoca\xE7\xE3o de todos os(as) respons\xE1veis(as)",D.value=u.response.data.errors.map(b=>{var E;return(E=b.extensions)==null?void 0:E.message}).join("<br>"))}).finally(()=>{y.value=!1})},M=()=>{$.value=[],J(()=>Ue({school:R.filter.school,grade:R.filter.grade,year:R.processYear}))};return(u,b)=>(a(),j(Ve,{modelValue:s(T),"onUpdate:modelValue":b[3]||(b[3]=E=>Ge(T)?T.value=E:null),large:!0,title:s(C),"overflow-visible":!A.value&&x.step==="ACCEPT","no-footer":""},{body:W(()=>[x.preregistrations&&A.value===!1?(a(),r("div",yo,[e("div",xo,[x.step==="REJECT"?(a(),r("div",wo,$o)):c("",!0),x.step==="ACCEPT"?(a(),r("div",ko,[So,Ro,_(P,{modelValue:F.value,"onUpdate:modelValue":b[0]||(b[0]=E=>F.value=E),"container-class":"col-12 form-group mt-3",rules:"required",label:"Para qual turma deseja designar os(as) alunos(as)?",name:"classroom",type:"SELECT",errors:l.value,options:s($)},null,8,["modelValue","errors","options"])])):c("",!0),x.step==="SUMMON"?(a(),r("div",No,Do)):c("",!0),x.step==="SUMMON"?(a(),r("div",Io,[Oo,Q(e("textarea",{"onUpdate:modelValue":b[1]||(b[1]=E=>k.value=E),class:"form-control",rows:"3"},null,512),[[fe,k.value]])])):c("",!0),x.step==="REJECT"?(a(),r("div",Mo,[Po,Q(e("textarea",{"onUpdate:modelValue":b[2]||(b[2]=E=>k.value=E),class:"form-control",rows:"3"},null,512),[[fe,k.value]])])):c("",!0),l.value?(a(),r("div",jo,[e("h2",Bo,n(V.value),1),e("span",{innerHTML:D.value},null,8,Uo)])):c("",!0),e("div",Lo,[x.step==="SUMMON"?(a(),j(S,{key:0,label:"Convocar respons\xE1veis",loading:y.value,color:"summon",outline:"",class:"ml-3 pmd-custom",icon:"pmd-summon","no-caps":"","no-wrap":"","loading-normal":"",onClick:i},null,8,["loading"])):c("",!0),x.step==="REJECT"?(a(),j(S,{key:1,label:"Indeferir pr\xE9-matr\xEDculas",loading:y.value,color:"rejected",outline:"",class:"ml-3 pmd-custom",icon:"pmd-rejected","no-caps":"","no-wrap":"","loading-normal":"",onClick:O},null,8,["loading"])):c("",!0),x.step==="ACCEPT"?(a(),j(S,{key:2,label:"Deferir pr\xE9-matr\xEDculas",loading:y.value,color:"accepted",outline:"",class:"ml-3 pmd-custom",icon:"pmd-accepted","no-caps":"","no-wrap":"","loading-normal":"",onClick:f},null,8,["loading"])):c("",!0)])])])):A.value===!1?(a(),r("div",zo,"Carregando..")):c("",!0),x.preregistrations&&A.value===!0?(a(),r("div",Fo,[x.step==="ACCEPT"?(a(),r("div",Wo,n(N.value)+" matr\xEDcula(s) deferida(s) com sucesso ",1)):c("",!0),x.step==="REJECT"?(a(),r("div",Go,n(N.value)+" matr\xEDcula(s) indeferida(s) com sucesso ",1)):c("",!0),x.step==="SUMMON"?(a(),r("div",Ho,n(N.value)+" matr\xEDcula(s) convocada(s) com sucesso ",1)):c("",!0),l.value?(a(),r("div",Jo,[e("h2",qo,n(V.value),1),e("span",{innerHTML:D.value},null,8,Yo)])):c("",!0),e("div",Xo,[_(S,{class:"ml-3 mr-3 w-50",color:"success",label:"Fechar","no-caps":"","no-wrap":"",onClick:B})])])):c("",!0)]),_:1},8,["modelValue","title","overflow-visible"]))}});var Oe=function(x,G,R,H){var Y=typeof H<"u"?[H,x]:[x],z=new Blob(Y,{type:R||"application/octet-stream"});if(typeof window.navigator.msSaveBlob<"u")window.navigator.msSaveBlob(z,G);else{var J=window.URL&&window.URL.createObjectURL?window.URL.createObjectURL(z):window.webkitURL.createObjectURL(z),$=document.createElement("a");$.style.display="none",$.href=J,$.setAttribute("download",G),typeof $.download>"u"&&$.setAttribute("target","_blank"),document.body.appendChild($),$.click(),setTimeout(function(){document.body.removeChild($),window.URL.revokeObjectURL(J)},200)}};const Zo=e("h1",null,"Pr\xE9-matr\xEDculas",-1),Qo={class:"row m-0 mt-1 filter-gutters mb-md-3"},et={class:"row m-0 filter-gutters mt-md-4"},ot={class:"d-flex m-0 mt-3 filter-gutters flex-column flex-lg-row"},tt={class:"d-flex flex-grow-1"},st={class:"d-flex justify-content-end flex-grow-1 mt-2 mt-md-0"},lt={class:"d-flex flex-column flex-lg-row mb-4"},at={class:"mb-3 mb-lg-0"},nt=e("option",{value:null},"Ordenar por:",-1),rt={class:"ml-lg-auto"},it={class:"align-items-baseline d-flex font-hind mb-2"},dt=e("div",{class:"mr-2"},"Mostrar",-1),ct={class:"mr-2"},ut=e("div",null,"registros por p\xE1gina",-1),mt={key:1,class:"table table-responsive table-striped table-vcenter"},pt={class:"w-1"},vt={class:"custom-control custom-checkbox"},ht=e("label",{class:"custom-control-label",for:"allChecked"},null,-1),ft=e("th",null,"Status",-1),_t=e("th",null,"Protocolo",-1),gt=e("th",null,"Nome do(a) aluno(a)",-1),Et=e("th",null,"Escola",-1),bt=e("th",null,"Posi\xE7\xE3o",-1),yt=e("th",null,"S\xE9rie",-1),xt=e("th",null,"Turno",-1),wt=e("th",null,"Tipo",-1),Tt={key:0},Ct=e("td",{colspan:"9"},"Nenhum resultado.",-1),$t=[Ct],kt={class:"w-1"},St={class:"custom-control custom-checkbox"},Rt=["id","value"],Nt=["for"],At=["onClick"],Vt={key:0},Dt={class:"align-top"},It={key:1},Ot={class:"align-top"},Mt={key:0},Pt={class:"align-top"},jt={key:1},Bt={class:"align-top"},Ut={key:2,class:"row justify-content-center mt-4"},Lt={class:"col-12 col-lg-3"},zt={class:"row"},Ft={class:"row"},Wt={class:"col-12"},Gt=Ae({__name:"PreRegistrationList",setup(x){const{dialog:G}=Ke(),{loader:R}=q(),{loader:H}=q(),{loader:Y,loading:z}=q(),{loader:J,loading:$}=Ze(d({title:"Aten\xE7\xE3o!",description:"N\xE3o foi poss\xEDvel emitir o relat\xF3rio. Verifique os filtros e tente novamente."})),k=Be(),F=je(),A=Pe(),l=w(()=>A),V=d(),D=d(null),y=d(!1),N=d(),T=d(!1),C=d([]),X=d(),B=d(),f=d([]),O=d({search:"",process:null,school:null,grade:null,canAcceptInBatch:!1,sort:null,year:null,schools:null}),i=d({search:"",process:null,school:null,grade:null,sort:null,canAcceptInBatch:!1,year:null,schools:null}),M=d([]),u=d([]),b=d([]),E=d([]),ge=d(["REGISTRATION","REGISTRATION_RENEWAL","WAITING_LIST"]),Ee=d(["REJECTED","ACCEPTED","WAITING","SUMMONED","IN_CONFIRMATION"]),de=d([]),L=d(25),be=d([{key:25,label:"25"},{key:50,label:"50"},{key:100,label:"100"},{key:200,label:"200"},{key:400,label:"400"}]),K=d(!0),oe=d(!1),Z=d({template:1,showStudentShortName:!0}),ce=w(()=>C.value.length===0),ye=w(()=>i.value.canAcceptInBatch?C.value.length===0:!0),xe=w(()=>C.value.length===0),we=w(()=>{let h=[];return i.value.year&&(h=M.value.filter(o=>o.schoolYear.year===i.value.year)),h}),Te=w(()=>{const h={key:null,label:"Nenhum"},o=ge.value.map(g=>({key:g,label:le(g)}));return o.unshift(h),o}),ue=w(()=>{const h={key:null,label:"Nenhum"},o=E.value.map(g=>({key:g.id,label:g.name}));return o.unshift(h),o}),Ce=w(()=>{const h={key:null,label:"Nenhum"},o=Ee.value.map(g=>({key:g,label:Ne(g)}));return o.unshift(h),o}),$e=w(()=>K.value===!1&&f.value.length===0),ke=()=>{Y(()=>ho(i.value)).then(h=>{Oe(h,"pre-matricula.csv")})},me=()=>{const h=M.value.find(o=>o.id===i.value.process);D.value=h.schoolYear.year,N.value="ACCEPT",y.value=!0},Se=()=>{N.value="REJECT",y.value=!0},pe=()=>{N.value="SUMMON",y.value=!0},m=h=>{K.value=!0;const o={...i.value,page:h};Object.keys(o).forEach(g=>{(!o[g]||o[g]==="")&&delete o[g]}),k.auth.user&&k.auth.user.level>=4&&(o.schools=k.auth.user.schools),R(()=>mo({first:Number(L.value),...o})).then(g=>{if(!g)return;X.value=g.stats,f.value=g.preregistrations,B.value=g.paginator,C.value=[];const{process:se,school:t,grade:I}=i.value;se&&t&&I&&(i.value.canAcceptInBatch=!0)}).finally(()=>{K.value=!1})},v=h=>{h.target.checked||(T.value=!1),C.value.length===f.value.length&&(T.value=!0)},p=h=>{h.target.checked?C.value=f.value.map(g=>g.id):C.value=[]},te=()=>{i.value={...O.value},m(1)},Re=()=>{const{process:h}=i.value;if(!h){G({title:"Aten\xE7\xE3o!",description:"Selecione um processo.",titleClass:"danger",iconLeft:"status-red"});return}const o={...i.value};Object.assign(o,{...Z.value}),J(()=>po(o)).then(g=>{Oe(g,"pre-matricula.pdf")}).finally(()=>{oe.value=!1})},le=h=>{switch(h){case"REGISTRATION":return"Matr\xEDcula";case"REGISTRATION_RENEWAL":return"Rematr\xEDcula";case"WAITING_LIST":default:return"Lista de espera"}},U=h=>{switch(h){case"REGISTRATION":return"badge-blue";case"REGISTRATION_RENEWAL":return"badge-cyan";case"WAITING_LIST":default:return"badge-yellow"}},ae=h=>{F.push({name:"preregistration.modal",params:{protocol:h}})};(()=>{const h={};k.auth.user&&k.auth.user.level>=4&&(h.schools=k.auth.user.schools),H(()=>vo(h)).then(o=>{M.value=o.processes.sortBy("name"),u.value=o.schools.sortBy("name"),b.value=o.grades.sortBy("name"),E.value=o.periods.sortBy("name");const g=[],se=[];o.processes.forEach(I=>{I.totalPreRegistrations>0?g.push(I.schoolYear.year):se.push(I.schoolYear.year)}),g.sort().reverse();const t=g[0];de.value=g.concat(se).filter((I,ze,Fe)=>Fe.indexOf(I)===ze).map(I=>({key:I,label:I})).sortBy("key").reverse(),t&&(i.value.year=t),u.value.length===1&&(i.value.school=u.value[0].id),m(1)})})(),_e(l,h=>{m(h.query.page||1)},{deep:!0}),_e(L,()=>{B.value&&m(B.value.currentPage)},{deep:!0});const Le={toExport:ke};return(h,o)=>{const g=qe("router-view"),se=Ye("tooltip");return a(),r("main",null,[Zo,_(Qe,{stats:X.value},null,8,["stats"]),_(oo,{class:"bg-primary mb-5"},{default:W(()=>[_(eo,{class:"pl-2 pr-2"},{default:W(()=>[e("form",{onSubmit:o[13]||(o[13]=He(t=>m(1),["prevent"]))},[e("div",Qo,[_(P,{modelValue:i.value.search,"onUpdate:modelValue":o[0]||(o[0]=t=>i.value.search=t),"container-class":"col-12 col-md-4 mb-2 mb-md-0",name:"search",placeholder:"Nome do(a) aluno(a)",type:"TEXT"},null,8,["modelValue"]),_(P,{modelValue:i.value.year,"onUpdate:modelValue":o[1]||(o[1]=t=>i.value.year=t),"container-class":"col-12 col-md-2 mb-2 mb-md-0",name:"year",placeholder:"Filtrar ano",type:"SELECT",options:de.value},null,8,["modelValue","options"]),_(P,{modelValue:i.value.process,"onUpdate:modelValue":o[2]||(o[2]=t=>i.value.process=t),"container-class":"col-12 col-md-3 mb-2 mb-md-0",name:"process",placeholder:"Filtrar por processo",type:"SELECT",options:s(we),searchable:"",onChange:o[3]||(o[3]=t=>i.value.canAcceptInBatch=!1)},null,8,["modelValue","options"]),_(P,{modelValue:i.value.type,"onUpdate:modelValue":o[4]||(o[4]=t=>i.value.type=t),"container-class":"col-12 col-md-3 mb-2 mb-md-0",name:"type",placeholder:"Filtrar por tipo",type:"SELECT",options:s(Te)},null,8,["modelValue","options"])]),e("div",et,[_(P,{modelValue:i.value.school,"onUpdate:modelValue":o[5]||(o[5]=t=>i.value.school=t),"container-class":"col-12 col-md-3 mb-2 mb-md-0",name:"school",placeholder:"Filtrar por escola",type:"SELECT",options:u.value,searchable:"",onChange:o[6]||(o[6]=t=>i.value.canAcceptInBatch=!1)},null,8,["modelValue","options"]),_(P,{modelValue:i.value.grade,"onUpdate:modelValue":o[7]||(o[7]=t=>i.value.grade=t),"container-class":"col-12 col-md-3 mb-2 mb-md-0",name:"grade",placeholder:"Filtrar por s\xE9rie",type:"SELECT",options:b.value,searchable:"",onChange:o[8]||(o[8]=t=>i.value.canAcceptInBatch=!1)},null,8,["modelValue","options"]),_(P,{modelValue:i.value.period,"onUpdate:modelValue":o[9]||(o[9]=t=>i.value.period=t),"container-class":"col-12 col-md-3 mb-2 mb-md-0",name:"period",placeholder:"Filtrar por turno",type:"SELECT",options:s(ue)},null,8,["modelValue","options"]),_(P,{modelValue:i.value.status,"onUpdate:modelValue":o[10]||(o[10]=t=>i.value.status=t),"container-class":"col-12 col-md-3 mb-2 mb-md-0",name:"status",placeholder:"Filtrar por status",type:"SELECT",options:s(Ce)},null,8,["modelValue","options"])]),e("div",ot,[e("div",tt,[_(S,{label:"Emitir relat\xF3rio",color:"white",outline:"",class:"ml-2","no-caps":"","no-wrap":"",icon:"mdi-note-text-outline","loading-normal":"",onClick:o[11]||(o[11]=t=>oe.value=!0)})]),e("div",st,[_(S,{"data-test":"cleanFilter",label:"Limpar",color:"white",flat:"",class:"mr-3","no-caps":"","no-wrap":"",onClick:te}),_(S,{"data-test":"btn-search-pre-registration",label:"Buscar",color:"white",outline:"",class:"mr-2","no-caps":"","no-wrap":"",loading:K.value,"loading-normal":"",onClick:o[12]||(o[12]=t=>m(1))},null,8,["loading"])])])],32)]),_:1})]),_:1}),e("div",lt,[e("div",at,[_(Ie,{modelValue:i.value.sort,"onUpdate:modelValue":o[14]||(o[14]=t=>i.value.sort=t),options:s(to)(),class:"custom-select",onChange:o[15]||(o[15]=t=>m(1))},{option:W(()=>[nt]),_:1},8,["modelValue","options"])]),e("div",rt,[_(S,{"data-test":"summon",label:"Convocar respons\xE1veis",disable:s(xe),color:"summon",outline:"",class:"ml-0 ml-lg-3 mb-2 mb-lg-0 pmd-custom",icon:"pmd-summon","no-caps":"","no-wrap":"",onClick:pe},null,8,["disable"]),_(S,{"data-test":"reject",label:"Indeferir pr\xE9-matr\xEDcula",disable:s(ce),color:"rejected",outline:"",class:"ml-0 ml-lg-3 mb-2 mb-lg-0 pmd-custom",icon:"pmd-rejected","no-caps":"","no-wrap":"",onClick:Se},null,8,["disable"]),_(S,{"data-test":"accept",label:"Deferir pr\xE9-matr\xEDcula",disable:s(ye),color:"accepted",outline:"",class:"ml-0 ml-lg-3 mb-2 mb-lg-0 pmd-custom",icon:"pmd-accepted","no-caps":"","no-wrap":"",onClick:me},null,8,["disable"])])]),e("div",it,[dt,e("div",ct,[_(Ie,{modelValue:L.value,"onUpdate:modelValue":o[16]||(o[16]=t=>L.value=t),options:be.value,class:"form-control form-control-sm"},null,8,["modelValue","options"])]),ut]),K.value?(a(),j(ao,{key:0})):(a(),r("table",mt,[e("thead",null,[e("tr",null,[e("th",pt,[e("div",vt,[Q(e("input",{id:"allChecked","onUpdate:modelValue":o[17]||(o[17]=t=>T.value=t),type:"checkbox",class:"custom-control-input",onChange:p},null,544),[[De,T.value]]),ht])]),ft,_t,gt,Et,bt,yt,xt,wt])]),e("tbody",null,[s($e)?(a(),r("tr",Tt,$t)):(a(!0),r(ne,{key:1},ve(f.value,t=>(a(),r("tr",{key:t.id},[e("td",kt,[e("div",St,[Q(e("input",{id:`checkbox-${t.id}`,"onUpdate:modelValue":o[18]||(o[18]=I=>C.value=I),value:t.id,type:"checkbox",class:"custom-control-input",onChange:v},null,40,Rt),[[De,C.value]]),e("label",{for:`checkbox-${t.id}`,class:"custom-control-label"},null,8,Nt)])]),e("td",null,[Q(e("span",{class:re(s(he)(t.status))},null,2),[[se,s(Ne)(t.status),void 0,{"bottom-start":!0}]])]),e("td",null,[e("a",{"data-test":"protocol",href:"javascript:void(0)",onClick:I=>ae(t.protocol)}," #"+n(t.protocol),9,At)]),e("td",null,n(t.student.name),1),e("td",null,[ee(n(t.school.name)+" ",1),t.waiting?(a(),r("div",Vt,[e("small",Dt,n(t.waiting.school.name),1),e("span",{class:re(s(he)(t.waiting.status))},null,2)])):c("",!0),t.parent?(a(),r("div",It,[e("small",Ot,n(t.parent.school.name),1),e("span",{class:re(s(he)(t.parent.status))},null,2)])):c("",!0)]),e("td",null,[ee(n(t.position)+"\xBA ",1),t.waiting?(a(),r("div",Mt,[e("small",Pt,n(t.waiting.position)+"\xBA ",1)])):c("",!0),t.parent?(a(),r("div",jt,[e("small",Bt,n(t.parent.position)+"\xBA ",1)])):c("",!0)]),e("td",null,n(t.grade?t.grade.name:"-"),1),e("td",null,n(t.period?t.period.name:"-"),1),e("td",null,[e("span",{class:re([U(t.type),"badge"])},n(le(t.type)),3)])]))),128))])])),_(so,{"paginator-info":B.value,onPage:o[19]||(o[19]=t=>m(t))},null,8,["paginator-info"]),B.value&&B.value.total?(a(),r("div",Ut,[e("div",Lt,[_(S,{"data-test":"toExport",label:"Exportar",loading:s(z),class:"w-100",color:"primary","no-caps":"","no-wrap":"","loading-normal":"",onClick:o[20]||(o[20]=t=>Le.toExport())},null,8,["loading"])])])):c("",!0),y.value?(a(),j(Ko,{key:3,modelValue:y.value,"onUpdate:modelValue":o[21]||(o[21]=t=>y.value=t),filter:i.value,preregistrations:C.value,"process-year":D.value,step:N.value,onLoad:m},null,8,["modelValue","filter","preregistrations","process-year","step"])):c("",!0),_(Ve,{ref_key:"fieldsModal",ref:V,modelValue:oe.value,"onUpdate:modelValue":o[26]||(o[26]=t=>oe.value=t),"no-footer":"",title:"Emitir Relat\xF3rio","is-overflow-visible":""},{body:W(()=>[e("div",zt,[_(P,{id:"reportModel",modelValue:Z.value.template,"onUpdate:modelValue":o[22]||(o[22]=t=>Z.value.template=t),label:"Modelo",rules:"required",name:"reportModel",type:"SELECT","allow-clear":!1,searchable:!1,options:s(lo)(),placeholder:"Selecione o modelo","container-class":"col-12 form-group","onOpen:options":o[23]||(o[23]=t=>V.value.setOverflowVisible(!0)),"onClose:options":o[24]||(o[24]=t=>V.value.setOverflowVisible(!1))},null,8,["modelValue","options"]),_(P,{modelValue:Z.value.showStudentShortName,"onUpdate:modelValue":o[25]||(o[25]=t=>Z.value.showStudentShortName=t),name:"showStudentShortName","container-class":"col-12 form-group",label:"Exibir apenas iniciais do nome do candidato?",type:"CHECKBOX"},null,8,["modelValue"])])]),footer:W(()=>[e("div",Ft,[e("div",Wt,[_(S,{"data-test":"toReport",loading:s($),color:"primary",class:"w-100",label:"Emitir relat\xF3rio","no-caps":"","no-wrap":"",onClick:Re},null,8,["loading"])])])]),_:1},8,["modelValue"]),_(g,null,{default:W(({Component:t})=>[(a(),j(Je(t),{key:s(A).path}))]),_:1})])}}}),Bl=Object.freeze(Object.defineProperty({__proto__:null,default:Gt},Symbol.toStringTag,{value:"Module"})),Ht={class:"m-auto",style:{"max-width":"740px"}},Jt={key:0,class:"mt-4 text-danger font-weight-bold"},qt=ee(" Tem certeza que deseja indeferir a pr\xE9-matr\xEDcula? "),Yt=e("hr",null,null,-1),Xt=[qt,Yt],Kt={key:1,class:"mt-4 font-weight-bold"},Zt=ee(" Selecione a turma que deseja matricular o(a) aluno(a) para completar o deferimento da pr\xE9-matr\xEDcula do(a) aluno(a). "),Qt=e("hr",null,null,-1),es=[Zt,Qt],os={key:2},ts=e("div",{class:"mt-4 text-danger font-weight-bold"},"Indeferido",-1),ss={class:"row mt-4"},ls={class:"col-6"},as=e("dt",{class:"font-hind font-size-10"}," Justificativa do indeferimento ",-1),ns=e("hr",null,null,-1),rs={key:3},is=e("div",{class:"mt-4 font-weight-bold",style:{color:"#1900b4"}}," Em convoca\xE7\xE3o ",-1),ds={class:"row mt-4"},cs={class:"col-12"},us=e("dt",{class:"font-hind font-size-10"},"Observa\xE7\xF5es",-1),ms=e("hr",null,null,-1),ps={key:4},vs=e("div",{class:"mt-4 text-success font-weight-bold"},"Deferido",-1),hs={class:"row mt-4"},fs={class:"col-6"},_s=e("dt",{class:"font-hind font-size-10"},"Escola",-1),gs={key:0,class:"col-6"},Es=e("dt",{class:"font-hind font-size-10"},"Turma",-1),bs=e("hr",null,null,-1),ys={class:"row mt-4"},xs={class:"col-6"},ws=e("dt",{class:"font-hind font-size-10"},"Posi\xE7\xE3o",-1),Ts={class:"col-6"},Cs=e("dt",{class:"font-hind font-size-10"},"Tipo",-1),$s={class:"col-6"},ks=e("dt",{class:"font-hind font-size-10"},"S\xE9rie",-1),Ss={class:"col-6"},Rs=e("dt",{class:"font-hind font-size-10"},"Turno",-1),Ns={class:"col-12"},As=e("dt",{class:"font-hind font-size-10"},"Fase escolar",-1),Vs={class:"col-12"},Ds=e("dt",{class:"font-hind font-size-10"},"Escola",-1),Is={class:"col-12"},Os=e("dt",{class:"font-hind font-size-10"},"Data da solicita\xE7\xE3o",-1),Ms={key:5,class:"row"},Ps={key:0,class:"col-12 mb-3"},js={class:"alert badge-yellow"},Bs=e("strong",null," Este aluno tamb\xE9m est\xE1 em lista de espera: ",-1),Us={class:"row mt-3"},Ls={class:"col-2 mb-0"},zs=e("dt",{class:"font-hind font-size-10"},"Protocolo",-1),Fs={class:"col-2 mb-0"},Ws=e("dt",{class:"font-hind font-size-10"},"Posi\xE7\xE3o",-1),Gs={class:"col-8 mb-0"},Hs=e("dt",{class:"font-hind font-size-10"},"Escola",-1),Js={key:1,class:"col-12 mb-3"},qs={class:"alert badge-blue"},Ys=e("strong",null," Este(a) aluno(a) tamb\xE9m possui uma outra solicita\xE7\xE3o de matr\xEDcula: ",-1),Xs={class:"row mt-3"},Ks={class:"col-2 mb-0"},Zs=e("dt",{class:"font-hind font-size-10"},"Protocolo",-1),Qs={class:"col-2 mb-0"},el=e("dt",{class:"font-hind font-size-10"},"Posi\xE7\xE3o",-1),ol={class:"col-8 mb-0"},tl=e("dt",{class:"font-hind font-size-10"},"Escola",-1),sl={class:"font-hind font-size-10"},ll=e("h3",{class:"font-hind-18-primary mt-4"}," Dados do(a) respons\xE1vel pelo(a) aluno(a) ",-1),al=e("hr",null,null,-1),nl={class:"row"},rl={class:"col-6"},il=e("dt",{class:"font-hind font-size-10"},"Rela\xE7\xE3o com o(a) aluno(a)",-1),dl={class:"row"},cl={class:"font-hind font-size-10"},ul={class:"col-6"},ml=e("dt",{class:"font-hind font-size-10"},"Endere\xE7o",-1),pl={class:"col-6"},vl=e("dt",{class:"font-hind font-size-10"},"N\xFAmero",-1),hl={key:0,class:"col-6"},fl=e("dt",{class:"font-hind font-size-10"},"Complemento",-1),_l={class:"col-6"},gl=e("dt",{class:"font-hind font-size-10"},"Bairro",-1),El={class:"col-6"},bl=e("dt",{class:"font-hind font-size-10"},"Cidade",-1),yl={class:"col-6"},xl=e("dt",{class:"font-hind font-size-10"}," Foi alterado a localiza\xE7\xE3o manualmente? ",-1),wl={key:7,class:"form-group"},Tl=e("label",{class:"form-label"},"Observa\xE7\xF5es (opcional)",-1),Cl={key:8,class:"form-group"},$l=e("label",{class:"form-label"},"Justificativa (opcional)",-1),kl={key:9,class:"mt-4 font-weight-bold"},Sl={class:"row"},Rl={key:10},Nl={class:"text-danger"},Al=["innerHTML"],Vl={class:"d-flex flex-column flex-lg-row justify-content-center"},Dl={inheritAttrs:!1},Il=Ae({...Dl,__name:"PreRegistrationModal",setup(x){const G=Xe("$filters"),{loader:R,loading:H}=ie(),{loader:Y,loading:z}=q(),{loader:J,loading:$}=q(),{loader:k,data:F}=q([]),{loader:A,data:l}=q({}),{loader:V,loading:D}=ie(),y=Be(),N=Pe(),T=je(),C=d({responsible:[],student:[]}),X=d({}),B=d({}),f=d("SHOW"),O=d(""),i=d(),M=d(!1),u=d(),b=d(),E=d(!0),ge=w(()=>y.isAdmin),Ee=w(()=>y.isCoordinator),de=w(()=>y.isSecretary),L=w(()=>Object.keys(l.value).length===0),be=w(()=>(f.value==="SHOW"||f.value==="ACCEPT")&&l.value.status!=="ACCEPTED"),K=w(()=>(ge.value||Ee.value||de.value)&&l.value.status!=="WAITING"&&f.value==="SHOW"),oe=w(()=>(f.value==="SHOW"||f.value==="REJECT")&&(l.value.status==="WAITING"||l.value.status==="SUMMONED")),Z=w(()=>(f.value==="SHOW"||f.value==="SUMMON")&&l.value.status==="WAITING"),ce=(m,v)=>v==="STUDENT"?m.filter(B.value[m.key]):m.filter(X.value[m.key]),ye=()=>{if(M.value=!1,f.value==="SHOW")f.value="ACCEPT";else if(f.value==="ACCEPT"){if(!Number(i.value)){M.value=!0,u.value="\xC9 necess\xE1rio selecionar uma turma para realizar o Deferimento da pr\xE9-matr\xEDcula.",b.value="";return}R(()=>fo({ids:[l.value.id].map(m=>Number(m)),classroom:Number(i.value)})).then(()=>{T.push({name:"preregistrations"})}).catch(m=>{var v;M.value=!0,u.value=m.response.data.errors[0].message,b.value=(v=m.response.data.errors[0].extensions)==null?void 0:v.message})}},xe=()=>{f.value==="SHOW"?(O.value="",f.value="REJECT"):f.value==="REJECT"&&Y(()=>_o({ids:[l.value.id],justification:O.value})).then(()=>{T.push({name:"preregistrations"})})},we=()=>{J(()=>go({ids:[l.value.id]})).then(()=>{T.push({name:"preregistrations"})})},Te=()=>{k(()=>Ue({period:l.value.period.id,school:l.value.school.id,grade:l.value.grade.id,year:l.value.process.schoolYear.year}))},ue=m=>{T.push({name:"preregistration.modal",params:{protocol:m}})},Ce=m=>{switch(m){case"REGISTRATION":return"Matr\xEDcula";case"REGISTRATION_RENEWAL":return"Rematr\xEDcula";case"WAITING_LIST":default:return"Lista de espera"}},$e=m=>{switch(m){case"REGISTRATION":return"badge-blue";case"REGISTRATION_RENEWAL":return"badge-cyan";case"WAITING_LIST":default:return"badge-yellow"}},ke=m=>{var v;return(v=y.relationTypes.find(p=>p.key===m))==null?void 0:v.label},me=m=>{l.value={},A(()=>Eo({protocol:m})).then(v=>{const{fields:p,data:te}=no(v.process),{fields:Re,data:le}=ro(v.process);v.fields.filter(U=>U.field.group==="RESPONSIBLE").forEach(U=>{const ae=`field_${U.field.id}`;te[ae]=U.value}),v.fields.filter(U=>U.field.group==="STUDENT").forEach(U=>{const ae=`field_${U.field.id}`;le[ae]=U.value}),C.value.responsible=p.sortBy("order"),X.value={...te,...v.responsible},C.value.student=Re.sortBy("order"),B.value={...le,...v.student},Te()})},Se=()=>{f.value==="SHOW"?(O.value="",f.value="SUMMON"):V(()=>bo({ids:[l.value.id],justification:O.value})).then(()=>{T.push({name:"preregistrations"})}).catch(m=>{M.value=!0,u.value="N\xE3o foi poss\xEDvel realizar a convoca\xE7\xE3o de todos os(as) respons\xE1veis(as)",b.value=m.response.data.errors.map(v=>{var p;return(p=v.extensions)==null?void 0:p.message}).join("<br>")})},pe=w(()=>N);return _e(pe,m=>{me(m.params.protocol)},{deep:!0}),_e(E,m=>{m||T.push({name:"preregistrations"})}),Me(()=>me(pe.value.params.protocol)),(m,v)=>(a(),j(Ve,{modelValue:E.value,"onUpdate:modelValue":v[5]||(v[5]=p=>E.value=p),"title-class":"font-hind-18-primary text-uppercase text-primary",title:s(L)?"":s(l).student.student_name,"icon-right":s(he)(s(L)?"":s(l).status),"tooltip-icon":s(Ne)(s(L)?"":s(l).status),"initial-loading":s(L),large:!0,"loading-text":"",persistent:s(L),onCloseModal:v[6]||(v[6]=p=>m.$router.push({name:"preregistrations"}))},{body:W(()=>[e("div",Ht,[f.value==="REJECT"?(a(),r("div",Jt,Xt)):c("",!0),f.value==="ACCEPT"?(a(),r("div",Kt,es)):c("",!0),s(l).status==="REJECTED"?(a(),r("div",os,[ts,e("div",ss,[e("dl",ls,[as,e("dd",null,n(s(l).observation),1)])]),ns])):c("",!0),s(l).status==="SUMMONED"&&s(l).observation?(a(),r("div",rs,[is,e("div",ds,[e("dl",cs,[us,e("dd",null,n(s(l).observation),1)])]),ms])):c("",!0),s(l).status==="ACCEPTED"?(a(),r("div",ps,[vs,e("div",hs,[e("dl",fs,[_s,e("dd",null,n(s(l).school.name),1)]),s(l).classroom?(a(),r("dl",gs,[Es,e("dd",null,n(s(l).classroom.name),1)])):c("",!0)]),bs])):c("",!0),e("div",ys,[e("dl",xs,[ws,e("dd",null,n(s(l).position)+"\xBA",1)]),e("dl",Ts,[Cs,e("dd",null,[e("span",{class:re([$e(s(l).type),"badge"])},n(Ce(s(l).type)),3)])]),e("dl",$s,[ks,e("dd",null,n(s(l).grade.name),1)]),e("dl",Ss,[Rs,e("dd",null,n(s(l).period.name),1)]),e("dl",Ns,[As,e("dd",null,n(s(l).grade.course.name),1)]),e("dl",Vs,[Ds,e("dd",null,n(s(l).school.name),1)]),e("dl",Is,[Os,e("dd",null,n(s(G).formatDateTime(s(l).date)),1)])]),f.value==="SHOW"?(a(),r("div",Ms,[s(l).waiting?(a(),r("div",Ps,[e("div",js,[Bs,e("div",Us,[e("dl",Ls,[zs,e("dd",null,[e("a",{href:"javascript:void(0)",onClick:v[0]||(v[0]=p=>ue(s(l).waiting.protocol))}," #"+n(s(l).waiting.protocol),1)])]),e("dl",Fs,[Ws,e("dd",null,n(s(l).waiting.position)+"\xBA",1)]),e("dl",Gs,[Hs,e("dd",null,n(s(l).waiting.school.name),1)])])])])):c("",!0),s(l).parent?(a(),r("div",Js,[e("div",qs,[Ys,e("div",Xs,[e("dl",Ks,[Zs,e("dd",null,[e("a",{href:"javascript:void(0)",onClick:v[1]||(v[1]=p=>ue(s(l).parent.protocol))}," #"+n(s(l).parent.protocol),1)])]),e("dl",Qs,[el,e("dd",null,n(s(l).parent.position)+"\xBA",1)]),e("dl",ol,[tl,e("dd",null,n(s(l).parent.school.name),1)])])])])):c("",!0),(a(!0),r(ne,null,ve(C.value.student,p=>(a(),r("dl",{key:p.id,class:"col-6"},[e("dt",sl,n(p.field.name),1),e("dd",null,n(ce(p,"STUDENT")),1)]))),128))])):c("",!0),f.value==="SHOW"?(a(),r(ne,{key:6},[ll,al,e("div",nl,[e("dl",rl,[il,e("dd",null,n(ke(s(l).relationType)),1)])]),e("div",dl,[(a(!0),r(ne,null,ve(C.value.responsible,p=>(a(),r("dl",{key:p.id,class:"col-6"},[e("dt",cl,n(p.field.name),1),e("dd",null,n(ce(p,"RESPONSIBLE")),1)]))),128))]),(a(!0),r(ne,null,ve(s(l).responsible.responsible_address,(p,te)=>(a(),r("div",{key:te,class:"row"},[e("dl",ul,[ml,e("dd",null,n(p.address),1)]),e("dl",pl,[vl,e("dd",null,n(p.number),1)]),p.complement?(a(),r("dl",hl,[fl,e("dd",null,n(p.complement),1)])):c("",!0),e("dl",_l,[gl,e("dd",null,n(p.neighborhood),1)]),e("dl",El,[bl,e("dd",null,n(p.city),1)]),e("dl",yl,[xl,e("dd",null,n(p.manualChangeLocation?"Sim":"N\xE3o"),1)])]))),128))],64)):c("",!0),f.value==="SUMMON"?(a(),r("div",wl,[Tl,Q(e("textarea",{"onUpdate:modelValue":v[2]||(v[2]=p=>O.value=p),class:"form-control",rows:"3"},null,512),[[fe,O.value]])])):c("",!0),f.value==="REJECT"?(a(),r("div",Cl,[$l,Q(e("textarea",{"onUpdate:modelValue":v[3]||(v[3]=p=>O.value=p),class:"form-control",rows:"3"},null,512),[[fe,O.value]])])):c("",!0),f.value==="ACCEPT"?(a(),r("div",kl,[e("div",Sl,[_(P,{modelValue:i.value,"onUpdate:modelValue":v[4]||(v[4]=p=>i.value=p),"container-class":"col-12",name:"classroom",rules:"required",label:"Para qual turma deseja designar o aluno(a)?",type:"SELECT",errors:M.value,options:s(F)},null,8,["modelValue","errors","options"])])])):c("",!0),M.value?(a(),r("div",Rl,[e("h2",Nl,n(u.value),1),e("span",{innerHTML:b.value},null,8,Al)])):c("",!0)])]),footer:W(()=>[e("div",Vl,[s(Z)?(a(),j(S,{key:0,loading:s(D),color:"summon",outline:"",class:"ml-3 mr-3 mb-3 mb-lg-0",label:"Convocar respons\xE1veis",icon:"pmd-summon","no-wrap":"","no-caps":"","loading-normal":"",onClick:Se},null,8,["loading"])):c("",!0),s(oe)?(a(),j(S,{key:1,loading:s(z),color:"rejected",outline:"",class:"ml-3 mr-3 mb-3 mb-lg-0",label:"Indeferir pr\xE9-matr\xEDcula",icon:"pmd-rejected","no-wrap":"","no-caps":"","loading-normal":"",onClick:xe},null,8,["loading"])):c("",!0),s(K)?(a(),j(S,{key:2,loading:s($),color:"to-wait",outline:"",class:"ml-3 mr-3 mb-3 mb-lg-0",label:"Voltar para em espera",icon:"pmd-to-wait","no-wrap":"","no-caps":"","loading-normal":"",onClick:we},null,8,["loading"])):c("",!0),s(be)?(a(),j(S,{key:3,loading:s(H),color:"accepted",outline:"",class:"ml-3 mr-3 mb-3 mb-lg-0",label:"Deferir pr\xE9-matr\xEDcula",icon:"pmd-accepted","no-wrap":"","no-caps":"","loading-normal":"",onClick:ye},null,8,["loading"])):c("",!0)])]),_:1},8,["modelValue","title","icon-right","tooltip-icon","initial-loading","persistent"]))}}),Ul=Object.freeze(Object.defineProperty({__proto__:null,default:Il},Symbol.toStringTag,{value:"Module"}));export{Bl as P,Ul as a};
